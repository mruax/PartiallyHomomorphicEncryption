# Генерация троек Бивера с использованием Paillier

Реализация алгоритма генерации мультипликативных троек (тройки Бивера) для двух сторон без участия третьей доверенной стороны (TTP), используя частично гомоморфное шифрование Paillier.

## Протокол генерации троек

Протокол использует частично гомоморфное шифрование Paillier для безопасной генерации троек (a, b, c), где c = a * b mod MPC_MODULO.
Шаги протокола:

1. Party 1 генерирует пару ключей Paillier и отправляет публичный ключ Party 2 
2. Party 1 генерирует случайные значения a₁, b₁ и вычисляет c₁_local = a₁ * b₁ 
3. Party 1 шифрует a₁ и b₁ и отправляет зашифрованные значения Party 2 
4. Party 2 генерирует случайные значения a₂, b₂ и вычисляет c₂_local = a₂ * b₂ 
5. Party 2 использует гомоморфные свойства для вычисления:

    ```
    E(a₁ * b₂) = E(a₁)^b₂
    E(a₂ * b₁) = E(b₁)^a₂
    E(a₁b₂ + a₂b₁) = E(a₁b₂) + E(a₂b₁)
    ```

6. Party 2 генерирует случайную маску r₂ и вычисляет E(cross_term - r₂)
7. Party 2 отправляет зашифрованное значение Party 1 и устанавливает c₂ = c₂_local + r₂
8. Party 1 расшифровывает cross_term и вычисляет c₁ = c₁_local + cross_term

Результат:

- Party 1 получает долю: (a₁, b₁, c₁)
- Party 2 получает долю: (a₂, b₂, c₂)
- Выполняется свойство: c₁ + c₂ ≡ (a₁ + a₂) * (b₁ + b₂) (mod MPC_MODULO)

## Запуск

```bash
docker compose up --build
```

Мы получим файлы `p1.csv` и `p2.csv`. Я на всякий случай сделал отдельную директорию output, но можно в целом было и напрямую в homework создавать (через volume). После перемещения файлов в homework мы запускаем:

```bash
python3 mul.py
```

### Пример запуска

Запуск Docker compose:

```bash
 ✔ homework-party1               Built                                                                                          0.0s 
 ✔ homework-party2               Built                                                                                          0.0s 
 ✔ Network homework_mpc_network  Created                                                                                        0.7s 
 ✔ Container party1              Created                                                                                        0.8s 
 ✔ Container party2              Created                                                                                        0.1s 
Attaching to party1, party2
party2  | [Gloo] Rank 1 is connected to 1 peer ranks. Expected number of connected peer ranks is : 1
party2  | Запущена сторона с rank=1, world_size=2
party1  | [Gloo] Rank 0 is connected to 1 peer ranks. Expected number of connected peer ranks is : 1
party1  | Запущена сторона с rank=0, world_size=2
party1  | Party 1: Начало генерации троек Бивера
party1  | Party 1: Генерация ключей Paillier (размер: 2048)
party2  | Party 2: Начало генерации троек Бивера
party2  | Party 2: Получение публичного ключа от Party 1
party1  | Party 1: Отправка публичного ключа Party 2
party1  | Party 1: Генерация тройки 1/10
party2  | Party 2: Генерация тройки 1/10
party2  | Party 2: Генерация тройки 2/10
party1  | Party 1: Генерация тройки 2/10
party2  | Party 2: Генерация тройки 3/10
party1  | Party 1: Генерация тройки 3/10
party2  | Party 2: Генерация тройки 4/10
party1  | Party 1: Генерация тройки 4/10
party2  | Party 2: Генерация тройки 5/10
party1  | Party 1: Генерация тройки 5/10
party2  | Party 2: Генерация тройки 6/10
party1  | Party 1: Генерация тройки 6/10
party2  | Party 2: Генерация тройки 7/10
party1  | Party 1: Генерация тройки 7/10
party2  | Party 2: Генерация тройки 8/10
party1  | Party 1: Генерация тройки 8/10
party2  | Party 2: Генерация тройки 9/10
party1  | Party 1: Генерация тройки 9/10
party2  | Party 2: Генерация тройки 10/10
party1  | Party 1: Генерация тройки 10/10
party2  | Party 2: Тройки сохранены в /app/output/p2.csv
party2  | Party 2: Завершено
party2  | Сторона 1 завершила работу
party1  | Party 1: Тройки сохранены в /app/output/p1.csv
party1  | Party 1: Завершено
party1  | Сторона 0 завершила работу
party1 exited with code 0
party2 exited with code 0
```

Я получил следующие значения.

p1.csv:

```csv
13007482903715193632,8376532616111004191,11310989710003074847
9490315344104036880,6230926117155342299,627241890311554834
8177350042993527446,8454687510580316445,13632611845624028507
7891813378365610478,10280541559396690872,266908062874667498
5324483092103874362,11447257388606964668,8435039819783440162
4676027229399845726,16735024494772629431,8114620049406294573
11071702800602671778,8075343494941020300,6595926047473610635
13626972214427783920,2422663760326410351,3869662646966186556
3262481853319587299,7634480197123375755,10689491186658091076
9785933199358106463,18090721287685960401,16104641172520870265
```

p2.csv:

```csv
17641363424680760402,4492030506670290373,12292615563326593129
5004394015270382914,8416219058881538183,10861656402226439762
2723904916602784767,5091276901762778877,17685297488776838599
1013684403591839270,16103178629710593050,17557345612796805758
17537647069358604817,7771288392057988377,10387910325662788677
4254451358526905612,3805290053417713702,5498095204618461013
4183565312187601025,4943789318489143678,7229470436332109267
5152774834247618315,17864376828434783285,1358781455022294672
12872442399209715181,776544351173195208,8281407401924617260
10006355978143329558,5434753309738672862,4185489624422236034
```

Теперь запустим скрипт для проверки csv-файлов:

```
All triples are correct
```

Все верно!

Также можно было сделать отдельную таску в docker compose для запуска `mul.py`, но я оставил так, поскольку тут остается просто запуск скрипта проверки.
